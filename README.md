# EmoBot

Приложение состоит из 3-ех проектов:
- EmoBot.Client: принимает обновления от телеграм-бота через webhooks, если эмодзи уже закэширован, то просто берет ссылку из кэша и отправляет пользователю ответ. Если эмодзи нет в кэше, то отправляет сообщение с эмодзи через EmojiRabbitDto в очередь через RabbitMQ на приём EmoBot.Converter. Здесь же запущена фоновая служба, которая принимает ответ от EmoBot.Converter, кэширует эмодзи и отправляет пользователю ответ в телеграм. 
- EmoBot.Converter: получает сообщения из очереди от EmoBot.Client, делает запрос к Giphy API через единственный метод-обертку, который находится в EmoBot.Giphy.API и отправляет ответ с ссылкой к EmoBot.Client.
- EmoBot.Giphy.API: оборачивает запрос Search Endpoint к Giphy API. Получает первое релевантное сообщение с рейтингом g(в других рейтингах поиск по эмодзи результата корректного не дает)

Для получения публичной ссылки использовал ngrok, запускать нужно обязательно на 443 или 80 порту: 
```sh
ngrok http 443 -host-header="localhost:443"
```

Токен и ссылку на бота можно задать в EmoBot.Client/appsettings. Здесь же конфигурация для mongodb и RabbitMQ.
Токен и ссылку для Giphy можно задать в EmoBot.Converter/appsettings. Здесь тоже конфигурация для RabbitMQ.

Я для удобства делал "Multiple Startup Projects", чтобы сразу запускать оба сервиса.

# Замечание

Бот не будет понимать все эмодзи. Я не знаю, какой версии Unicode использует Giphy при поиске по эмодзи. Но на особо новые из Unicode Version 10.0 и новее он, скорее всего, ничего не вернет. Так же и в mongodb не все эмодзи будут отображаться корректно. В .Net Core поддерживается отображение только для Unicode Version 8.0. 
В случае, если пользователь отправил не эмодзи или Giphy ничего не вернул, то пользователю отправляется сообщение о том, что эмодзи не поддерживается. 
